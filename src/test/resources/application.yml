###############################################################################
#
# Data Reurns Backend Service Configuration Settings
#
# This file is split into different sections, the first provides defaults
# for all environments.  Subsequent sections provide profile-specific
# configurations which may be enabled to override the default values.
#
###############################################################################
spring:
  application:
    name: Data Returns Backend Service
    admin:
      enabled: true
  datasource:
    url: ${db.url}
    username: ${db.username}
    password: ${db.password}
    driverClassName: ${db.driver}
    tomcat.max-wait: 10000
    tomcat.max-active: 50
    tomcat.test-on-borrow: true

  # Spring cache configuration settings.  Use type: simple for local concurrent map cache or type: redis to use a redis backed cache
  cache:
    type: simple

  aop:
    auto: true
    proxy-target-class: true

  jersey:
    application-path: /api/v1

  jackson:
    serialization:
      FAIL_ON_EMPTY_BEANS: false

  jpa:
    database-platform: ${db.dialect}
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        jdbc.fetch_size: 30
        jdbc.batch_size: 30
        order_inserts: true
        order_updates: true
        enable_lazy_load_no_trans: true

        cache:
          use_query_cache: false
#          use_second_level_cache: false
#          region:
#            factory_class: com.hazelcast.hibernate.HazelcastCacheRegionFactory
#          hazelcast:
#            use_native_client: true
#            native_client_address: localhost:5701
#            native_client_group: dev
#            native_client_password: dev-pass

# Configuration for authorization hashing
crypt:
  secretKey: ${dr.apikey}
  hashAlgorithm: HmacSHA256
  enabled: ${dr.apikey.enabled}

# Configuration for the web server
server:
  display-name: ${spring.application.name}
  address: 0.0.0.0
  port: 9020
  compression:
    enabled: true

# Configuration for the management server and its endpoints
management:
  port: 9021
  security:
    enabled: false
endpoints:
  shutdown:
    enabled: true
    sensitive: false
  info:
    enabled: true

# Liquibase database migration configuration values
liquibase:
  changeLog: classpath:/db/changelog/db.changelog-master.xml
  dropFirst: false
  enabled: true

# Default logging levels (provide minimal level of logging here)
logging:
  level: 
    root: WARN
    jndi: WARN
    uk.gov.ea.datareturns: INFO
    org.eclipse.jetty: WARN
    org.apache.http: WARN
    org.springframework: WARN
    org.springframework.boot: WARN
    org.springframework.boot.context.embedded.jetty.JettyEmbeddedServletContainer: INFO
    org.springframework.beans: info
    org.springframework.aop: info
    org.springframework.cache: debug
    javax.xml.bind: WARN
    
    # Database
    org.hibernate: WARN
    org.hibernate.engine.jdbc.spi.SqlExceptionHelper: OFF

    liquibase: INFO
    
    # Amazon S3 API
    com.amazonaws: WARN
    org.apache.http.wire: WARN
    # Glassfish
    org.glassfish: WARN
    # Useful to log REST requests and responses (set to INFO for headers or DEBUG for full request/response logging)
    org.glassfish.jersey.logging.LoggingFeature: WARN
    # Metrics logging
    metrics: INFO

test:
  testFilesLocation: /testfiles
  testTimeout: 1000000


---
###############################################################################
#
# Profile: debug
#
###############################################################################
spring:
  profiles: debug
  jpa:
    show-sql: false
    properties:
      hibernate.use_sql_comments: true
      hibernate.format_sql: true
      hibernate.generate_statistics: true

# Spring boot debug flag 
debug: false

# Configure loggers for debug - should configure DEBUG by default and use WARN/INFO on stuff that is not useful to reduce unwanted spam
logging:
  level: 
    root: DEBUG
    jndi: INFO
    uk.gov.ea.datareturns: DEBUG
    org.eclipse.jetty: INFO
    org.eclipse.jetty.server.Server: DEBUG
    org.eclipse.jetty.server.session: INFO
    org.eclipse.jetty.servlet.ServletHandler: DEBUG
    org.apache.http: INFO
    org.jvnet.mimepull: INFO
    
    org.springframework: INFO
    org.springframework.beans.factory: INFO
    org.springframework.boot: INFO
    org.springframework.jndi: INFO
    org.springframework.core: INFO
    org.springframework.context.annotation: INFO
    org.springframework.boot.context.embedded.jetty.JettyEmbeddedServletContainer: INFO
    
    # Set to DEBUG to enable the auto-configuration report at startup
    org.springframework.boot.autoconfigure: DEBUG

    org.reflections: INFO


    # Database
    org.hibernate: INFO
    org.hibernate.stat: DEBUG
    org.hibernate.engine.internal.StatisticalLoggingSessionEventListener: DEBUG
    liquibase: INFO
    
    # Amazon S3 API
    com.amazonaws: INFO
    org.apache.http.wire: INFO
    # Glassfish
    org.glassfish: INFO
    # Useful to log REST requests and responses (set to INFO for headers or DEBUG for full request/response logging)
    org.glassfish.jersey.logging.LoggingFeature: DEBUG


---
###############################################################################
#
# Profile: cluster
#
###############################################################################
spring:
  profiles: cluster


---
###############################################################################
#
# Profile: dev_cluster, test_cluster
#
###############################################################################
spring:
  profiles: dev_cluster,test_cluster
  profiles.include: debug,cluster


---
###############################################################################
#
# Profile: pre_prod
#
###############################################################################
spring:
  profiles: pre_prod
  profiles.include: cluster

---
###############################################################################
#
# Profile: production
#
###############################################################################
spring:
  profiles: production
  profiles.include: cluster

---
###############################################################################
#
# Profile: IntegrationTests
#
###############################################################################
spring:
  profiles: IntegrationTests

# Configuration for the web server
server:
  display-name: ${spring.application.name}
  address: 127.0.0.1
  port: 9120
  compression:
    enabled: true

# Configuration for the management server and its endpoints
management:
  port: -1

logging:
  level:
    root: INFO
    jndi: INFO
    uk.gov.ea.datareturns: DEBUG
    org.eclipse.jetty: INFO
    org.eclipse.jetty.server.Server: INFO
    org.eclipse.jetty.server.session: INFO
    org.eclipse.jetty.servlet.ServletHandler: INFO
    org.apache.http: INFO
    org.jvnet.mimepull: INFO

    org.springframework: INFO
    org.springframework.beans.factory: INFO
    org.springframework.boot: INFO
    org.springframework.jndi: INFO
    org.springframework.core: INFO
    org.springframework.context.annotation: INFO
    org.springframework.boot.context.embedded.jetty.JettyEmbeddedServletContainer: INFO
    org.springframework.boot.web.servlet: warn

    # Set to DEBUG to enable the auto-configuration report at startup
    org.springframework.boot.autoconfigure.logging: INFO

    # Database
    org.hibernate: INFO
    net.sf.ehcache: INFO
    liquibase: INFO

    # Amazon S3 API
    com.amazonaws: INFO
    org.apache.http.wire: INFO
    # Glassfish
    org.glassfish: INFO
    # Useful to log REST requests and responses (set to INFO for headers or DEBUG for full request/response logging)
    org.glassfish.jersey.logging.LoggingFeature: INFO