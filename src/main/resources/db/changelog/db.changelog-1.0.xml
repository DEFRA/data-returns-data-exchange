<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

	<preConditions>
		<dbms type="${db.type}"/>
		<runningAs username="${db.username}"/>
	</preConditions>

	<changeSet id="create-permit-table" author="aharrison">
		<createTable tableName="permit">
			<column name="permit_number" type="varchar(10)">	<!-- TODO guessed big enough, looks like could reduce to 8? -->
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>DROP TABLE permit</rollback>
	</changeSet>

	<!-- START - Load environment specific data -->
	
	<changeSet id="load-permit-data" author="aharrison">
		<preConditions onFail="CONTINUE">
			<sqlCheck expectedResult="0">select count(permit_number) from permit</sqlCheck>
		</preConditions>
		<loadData file="${permitDataFile}" tableName="permit"/>
		<rollback>DELETE * FROM permit</rollback>
	</changeSet>

	<!-- END - Load environment specific data -->

	<changeSet id="create-permit-id-index" author="aharrison">
		<createIndex indexName="idx_permit_number" tableName="permit" unique="true">
			<column name="permit_number" type="varchar(10)"/>	<!-- TODO guessed big enough, looks like could reduce to 8? -->
		</createIndex>
		<rollback>DROP INDEX idx_permit_number</rollback>
	</changeSet>

</databaseChangeLog>
