<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">
        
	<property name="uniqueIdentifiersFile" value="/db/data/UniqueIdentifiers.csv"/>
	<property name="returnTypesFile" value="/db/data/ReturnTypes.csv"/>
	<property name="parametersFile" value="/db/data/Parameters.csv"/>
	<property name="unitsFile" value="/db/data/Units.csv"/>
	<property name="methodsOrStandardsFile" value="/db/data/MethodsOrStandards.csv"/>
	<property name="qualifiersFile" value="/db/data/Qualifiers.csv"/>
	<property name="referencePeriodsFile" value="/db/data/ReferencePeriods.csv"/>
	<property name="returnPeriodsFile" value="/db/data/ReturnPeriods.csv"/>

	<preConditions>
		<dbms type="${db.type}"/>
		<runningAs username="${db.username}"/>
	</preConditions>

	<!-- 
	****************************************************************
	Unique Identifiers
	****************************************************************
	-->
	<changeSet id="create-table: unique_identifiers" author="Sam Gardner-Dell">
		<createTable tableName="unique_identifiers">
			<!-- Currently unique identifiers are generally 6 characters long but this could change! -->
			<column name="identifier" type="varchar(10)">
				<constraints nullable="false" primaryKey="true" unique="true"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="unique_identifiers"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: unique_identifiers" author="Sam Gardner-Dell">
		<preConditions onFail="HALT">
			<tableExists tableName="unique_identifiers"/>
			<columnExists tableName="unique_identifiers" columnName="identifier"/>
			<sqlCheck expectedResult="0">select count(identifier) from unique_identifiers</sqlCheck>
		</preConditions>
		<loadData file="${uniqueIdentifiersFile}" tableName="unique_identifiers"/>
		<rollback>
			<delete tableName="unique_identifiers"></delete>
		</rollback>
	</changeSet>

	<changeSet id="create-index: unique_identifiers" author="Sam Gardner-Dell">
		<createIndex indexName="idx_unique_identifiers_identifier" tableName="unique_identifiers" unique="true">
			<column name="identifier"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="unique_identifiers" indexName="idx_unique_identifiers_identifier"/>
		</rollback>
	</changeSet>


	<!-- 
	****************************************************************
	Return Types
	****************************************************************
	-->

	<changeSet id="create: sequence: return_types_seq" author="Graham Willis" >
		<createSequence incrementBy="1"
										minValue="0"
										sequenceName="return_types_seq"
										startValue="0"/>
		<rollback>
			<dropSequence sequenceName="return_types_seq"/>
		</rollback>
	</changeSet>

	<changeSet id="create-table: return_types" author="Graham Willis">
		<createTable tableName="return_types">
			<column name="id" type="bigint" defaultValueSequenceNext="return_types_seq" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(80)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="sector" type="varchar(20)">
				<constraints nullable="false" unique="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="return_types"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: return_types" author="Sam Gardner-Dell">
		<preConditions onFail="HALT">
			<tableExists tableName="return_types"/>
			<columnExists tableName="return_types" columnName="name"/>
			<sqlCheck expectedResult="0">select count(id) from return_types</sqlCheck>
		</preConditions>
		<loadData file="${returnTypesFile}" tableName="return_types"/>
		<rollback>
			<delete tableName="return_types"></delete>
		</rollback>
	</changeSet>

	<changeSet id="create-index: return_types" author="Sam Gardner-Dell">
		<createIndex indexName="idx_return_type_name" tableName="return_types" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="return_types" indexName="idx_return_type_name"/>
		</rollback>
	</changeSet>


	<!-- 
	****************************************************************
	Parameters
	****************************************************************
	-->
	<changeSet id="create-table: parameters" author="Sam Gardner-Dell">
		<createTable tableName="parameters">
			<column name="id" type="BIGINT" autoIncrement="true">
				<constraints primaryKey="true"/>
			</column>
			<column name="name" type="varchar(150)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="definition" type="varchar(150)">
			</column>
			<!--
				TODO: NOT SUPPORTING CAS RIGHT NOW AND THERE ARE ERRORS IN THE CONTROLLED LISTS DEFINITION IN THE HELP
				
				See ParametersWithCas.csv which includes the CAS column with a lot of invalid values and also multiple values that are
				separated by a comma for a single parameter type (which makes me think that CAS numbers should be in their own table)
				
				Cas numbers have specific rules about their format (e.g. 1-7 digits, dash, 2 digits, dash, check digit)
				See: https://www.cas.org/content/chemical-substances/checkdig and http://onelastbit.com/?p=444
			-->
			<!-- 			<column name="cas" type="varchar(15)"> -->
			<!-- 			</column> -->
		</createTable>
		<rollback>
			<dropTable tableName="parameters"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: parameters" author="Sam Gardner-Dell">
		<preConditions onFail="HALT">
			<tableExists tableName="parameters"/>
			<columnExists tableName="parameters" columnName="id"/>
			<sqlCheck expectedResult="0">select count(id) from parameters</sqlCheck>
		</preConditions>
		<loadData file="${parametersFile}" tableName="parameters"/>
		<rollback>
			<delete tableName="parameters"></delete>
		</rollback>
	</changeSet>

	<changeSet id="create-index: parameters" author="Sam Gardner-Dell">
		<createIndex indexName="idx_parameters_name" tableName="parameters" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="parameters" indexName="idx_parameters_name"/>
		</rollback>
	</changeSet>


	<!-- 
	****************************************************************
	Units
	****************************************************************
	-->
	<changeSet id="create-table: units" author="Sam Gardner-Dell">
		<createTable tableName="units">
			<column name="id" type="BIGINT" autoIncrement="true">
				<constraints primaryKey="true"/>
			</column>
			<column name="name" type="varchar(10)">
				<constraints nullable="false" unique="true"/>
			</column>
			<!-- TODO: This should probably be moved out to its own table -->
			<column name="measure_type" type="varchar(50)">
				<constraints nullable="false"/>
			</column>
			<column name="description" type="varchar(100)"/>
		</createTable>
		<rollback>
			<dropTable tableName="units"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: units" author="Sam Gardner-Dell">
		<preConditions onFail="HALT">
			<tableExists tableName="units"/>
			<columnExists tableName="units" columnName="id"/>
			<sqlCheck expectedResult="0">select count(id) from units</sqlCheck>
		</preConditions>
		<loadData file="${unitsFile}" tableName="units"/>
		<rollback>
			<delete tableName="units"></delete>
		</rollback>
	</changeSet>

	<changeSet id="create-index: units" author="Sam Gardner-Dell">
		<createIndex indexName="idx_units_name" tableName="units" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="units" indexName="idx_units_name"/>
		</rollback>
	</changeSet>

	<!-- 
	****************************************************************
	Method Or Standard
	****************************************************************
	-->
	<changeSet id="create: sequence: methods_or_standards_seq" author="Graham Willis" >
		<createSequence incrementBy="1"
										minValue="0"
										sequenceName="methods_or_standards_seq"
										startValue="0"/>
	</changeSet>

	<changeSet id="create-table: methods_or_standards" author="Graham Willis">
		<createTable tableName="methods_or_standards">
			<column name="id" type="bigint" defaultValueSequenceNext="methods_or_standards_seq" autoIncrement="true">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(30)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="description" type="varchar(500)">
				<constraints nullable="true" unique="false"/>
			</column>
			<column name="origin" type="varchar(200)">
				<constraints nullable="true" unique="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="methods_or_standards"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: methods_or_standards" author="Sam Gardner-Dell">
		<preConditions onFail="HALT">
			<tableExists tableName="methods_or_standards"/>
			<columnExists tableName="methods_or_standards" columnName="id"/>
			<sqlCheck expectedResult="0">select count(id) from methods_or_standards</sqlCheck>
		</preConditions>
		<loadData file="${methodsOrStandardsFile}" tableName="methods_or_standards"/>
		<rollback>
			<delete tableName="methods_or_standards"></delete>
		</rollback>
	</changeSet>

	<changeSet id="create-index: methods_or_standards" author="Sam Gardner-Dell">
		<createIndex indexName="idx_methods_or_standards_name" tableName="methods_or_standards" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="methods_or_standards" indexName="idx_methods_or_standards_name"/>
		</rollback>
	</changeSet>


	<!-- 
	****************************************************************
	Qualifiers
	****************************************************************
	-->
	<changeSet id="create: sequence: qualifiers_seq" author="Sam Gardner-Dell" >
		<createSequence incrementBy="1"
						minValue="0"
						sequenceName="qualifiers_seq"
						startValue="0"/>
		<rollback>
			<dropSequence sequenceName="qualifiers_seq"/>
		</rollback>
	</changeSet>

	<changeSet id="create-table: qualifiers" author="Sam Gardner-Dell">
		<createTable tableName="qualifiers">
			<column name="id" type="BIGINT" defaultValueSequenceNext="qualifiers_seq" autoIncrement="true">
				<constraints primaryKey="true"/>
			</column>
			<column name="name" type="varchar(70)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="description" type="varchar(100)"></column>
		</createTable>
		<rollback>
			<dropTable tableName="qualifiers"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: qualifiers" author="Sam Gardner-Dell">
		<preConditions onFail="HALT">
			<tableExists tableName="qualifiers"/>
			<columnExists tableName="qualifiers" columnName="id"/>
			<sqlCheck expectedResult="0">select count(id) from qualifiers</sqlCheck>
		</preConditions>
		<loadData file="${qualifiersFile}" tableName="qualifiers"/>
		<rollback>
			<delete tableName="qualifiers"></delete>
		</rollback>
	</changeSet>

	<changeSet id="create-index: qualifiers" author="Sam Gardner-Dell">
		<createIndex indexName="idx_qualifiers_name" tableName="qualifiers" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="qualifiers" indexName="idx_qualifiers_name"/>
		</rollback>
	</changeSet>


	<!-- 
	****************************************************************
	Reference Periods
	****************************************************************
	-->
	<changeSet id="create: sequence: reference_periods_seq" author="Graham Willis" >
		<createSequence incrementBy="1"
										minValue="0"
										sequenceName="reference_periods_seq"
										startValue="0"/>
	</changeSet>

	<changeSet id="create-table: reference_periods" author="Graham Willis">
		<createTable tableName="reference_periods">
			<column name="id" type="bigint" defaultValueSequenceNext="reference_periods_seq">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(200)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="description" type="varchar(500)">
				<constraints nullable="true" unique="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="reference_periods"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: reference_periods" author="Sam Gardner-Dell">
		<preConditions onFail="HALT">
			<tableExists tableName="reference_periods"/>
			<columnExists tableName="reference_periods" columnName="id"/>
			<sqlCheck expectedResult="0">select count(id) from reference_periods</sqlCheck>
		</preConditions>
		<loadData file="${referencePeriodsFile}" tableName="reference_periods"/>
		<rollback>
			<delete tableName="reference_periods"></delete>
		</rollback>
	</changeSet>

	<changeSet id="create-index: reference_periods" author="Sam Gardner-Dell">
		<createIndex indexName="idx_reference_periods_name" tableName="reference_periods" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="reference_periods" indexName="idx_reference_periods_name"/>
		</rollback>
	</changeSet>


	<!--
	****************************************************************
	Return Periods
	****************************************************************
	-->
	<changeSet id="create: sequence: return_periods_seq" author="Sam Gardner-Dell">
		<createSequence incrementBy="1"
						minValue="0"
						sequenceName="return_periods_seq"
						startValue="0"/>
		<rollback>
			<dropSequence sequenceName="return_periods_seq"/>
		</rollback>
	</changeSet>

	<changeSet id="create-table: return_periods" author="Sam Gardner-Dell">
		<createTable tableName="return_periods">
			<column name="id" type="BIGINT" autoIncrement="true" defaultValueSequenceNext="return_periods_seq">
				<constraints primaryKey="true"/>
			</column>
			<column name="name" type="varchar(120)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="description" type="varchar(1000)"></column>
			<column name="example" type="varchar(255)"></column>
		</createTable>
		<rollback>
			<dropTable tableName="return_periods"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: return_periods" author="Sam Gardner-Dell">
		<preConditions onFail="HALT">
			<tableExists tableName="return_periods"/>
			<columnExists tableName="return_periods" columnName="id"/>
			<sqlCheck expectedResult="0">select count(id) from return_periods</sqlCheck>
		</preConditions>
		<loadData file="${returnPeriodsFile}" tableName="return_periods"/>
		<rollback>
			<delete tableName="return_periods"></delete>
		</rollback>
	</changeSet>

	<changeSet id="create-index: return_periods" author="Sam Gardner-Dell">
		<createIndex indexName="idx_return_periods_name" tableName="return_periods" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="return_periods" indexName="idx_return_periods_name"/>
		</rollback>
	</changeSet>
</databaseChangeLog>