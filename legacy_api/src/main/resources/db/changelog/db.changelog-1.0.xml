<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
				   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

	<property name="parameterHierarchyFile" value="/db/data/ParameterHierarchy.csv"/>

	<property name="WML" value="/db/data/stage_data_initialization/EA-WML.csv"/>
	<property name="IPPC" value="/db/data/stage_data_initialization/IPPC.csv"/>
	<property name="PRE" value="/db/data/stage_data_initialization/Pre-EA.csv"/>
	<property name="EPR" value="/db/data/stage_data_initialization/EPR.csv"/>
	<property name="TEST" value="/db/data/stage_data_initialization/Test-Permit.csv"/>

	<preConditions>
		<dbms type="${db.type}"/>
		<runningAs username="${db.username}"/>
	</preConditions>

	<!--
	****************************************************************
  Sites
  ****************************************************************
  -->
	<changeSet id="create-table: sites" author="Environment Agency">
		<createTable tableName="md_sites">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(80)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_sites"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: sites" author="Environment Agency">
		<createIndex indexName="idx_md_sites_name" tableName="md_sites" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="sites" indexName="idx_md_sites_name"/>
		</rollback>
	</changeSet>

	<!--
	****************************************************************
	Unique Identifiers
	****************************************************************
	-->
	<changeSet id="create-table: unique_identifiers" author="Environment Agency">
		<createTable tableName="md_unique_identifiers">
			<!-- Currently unique identifiers are generally 6 characters long but this could change! -->
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(18)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="site_id" type="bigint">
				<constraints nullable="false" foreignKeyName="fk_site" references="md_sites(id)"/>
			</column>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_unique_identifiers"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: unique_identifiers" author="Environment Agency">
		<createIndex indexName="idx_md_unique_identifiers_name" tableName="md_unique_identifiers" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_unique_identifiers" indexName="idx_md_unique_identifiers_name"/>
		</rollback>
	</changeSet>

	<!--
	****************************************************************
	Unique Identifier Aliases
	****************************************************************
	-->
	<changeSet id="create-table: unique_identifier_aliases" author="Environment Agency">
		<createTable tableName="md_unique_identifier_aliases">
			<!-- Currently unique identifiers are generally 6 characters long but this could change! -->
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(18)">
				<constraints nullable="false"/>
			</column>
			<column name="preferred" type="bigint">
				<constraints nullable="false" foreignKeyName="fk_ea_id_preferred" references="md_unique_identifiers(id)"/>
			</column>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_unique_identifier_aliases"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: unique_identifier_aliases" author="Environment Agency">
		<createIndex indexName="idx_md_unique_identifier_aliases" tableName="md_unique_identifier_aliases" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_unique_identifier_aliases" indexName="idx_md_unique_identifier_aliases"/>
		</rollback>
	</changeSet>

	<!-- 
	****************************************************************
	Return Types
	****************************************************************
	-->
	<changeSet id="create-table: return_types" author="Environment Agency">
		<createTable tableName="md_return_types">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(80)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="sector" type="varchar(20)">
				<constraints nullable="false"/>
			</column>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_return_types"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: return_types" author="Environment Agency">
		<createIndex indexName="idx_md_return_types_name" tableName="md_return_types" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_return_types" indexName="idx_md_return_types_name"/>
		</rollback>
	</changeSet>

	<!--
	****************************************************************
	Parameters
	****************************************************************
  -->

	<changeSet id="create-table: parameters" author="Environment Agency">
		<createTable tableName="md_parameters">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(150)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="preferred" type="bigint">
				<constraints nullable="true" foreignKeyName="fk_parameters_preferred" references="md_parameters(id)"/>
			</column>
			<column name="type" type="varchar(100)"/>
			<column name="cas" type="varchar(50)"/>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_parameters"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: parameters" author="Environment Agency">
		<createIndex indexName="idx_md_parameters_name" tableName="md_parameters" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_parameters" indexName="idx_md_parameters_name"/>
		</rollback>
	</changeSet>

	<!--
	****************************************************************
	Units
	****************************************************************
	-->

	<changeSet id="create-table: units" author="Environment Agency">
		<createTable tableName="md_units">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(10)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="preferred" type="bigint">
				<constraints nullable="true" foreignKeyName="fk_units_preferred" references="md_units(id)"/>
			</column>
			<column name="long_name" type="varchar(50)"/>
			<column name="unicode" type="varchar(50)"/>
			<column name="description" type="varchar(200)"/>
			<column name="type" type="varchar(50)"/>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_units"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: units" author="Environment Agency">
		<createIndex indexName="idx_md_units_name" tableName="md_units" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_units" indexName="idx_md_units_name"/>
		</rollback>
	</changeSet>

	<!--
	****************************************************************
	Method Or Standard
	****************************************************************
	-->

	<changeSet id="create-table: methods_or_standards" author="Environment Agency">
		<createTable tableName="md_methods_or_standards">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(30)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="notes" type="varchar(250)"/>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_methods_or_standards"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: methods_or_standards" author="Environment Agency">
		<createIndex indexName="idx_md_methods_or_standards_name" tableName="md_methods_or_standards" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_methods_or_standards" indexName="idx_md_methods_or_standards_name"/>
		</rollback>
	</changeSet>

	<!-- 
	****************************************************************
	Qualifiers
	****************************************************************
	-->
	<changeSet id="create-table: qualifiers" author="Environment Agency">
		<createTable tableName="md_qualifiers">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(100)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="notes" type="varchar(100)"/>
			<column name="type" type="varchar(50)"/>
			<column name="singleormultiple" type="varchar(20)"/>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_qualifiers"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: qualifiers" author="Environment Agency">
		<createIndex indexName="idx_md_qualifiers_name" tableName="md_qualifiers" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_qualifiers" indexName="idx_md_qualifiers_name"/>
		</rollback>
	</changeSet>
	<!-- 
	****************************************************************
	Reference Periods
	****************************************************************
	-->
	<changeSet id="create-table: reference_periods" author="Environment Agency">
		<createTable tableName="md_reference_periods">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(100)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="preferred" type="bigint">
				<constraints nullable="true" foreignKeyName="fk_reference_periods_preferred"
							 references="md_reference_periods(id)"/>
			</column>
			<column name="notes" type="varchar(250)"/>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_reference_periods"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: reference_periods" author="Environment Agency">
		<createIndex indexName="idx_md_reference_periods_name" tableName="md_reference_periods" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_reference_periods" indexName="idx_md_reference_periods_name"/>
		</rollback>
	</changeSet>
	<!--
	****************************************************************
	Return Periods
	****************************************************************
	-->

	<changeSet id="create-table: return_periods" author="Environment Agency">
		<createTable tableName="md_return_periods">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(20)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="definition" type="varchar(600)"/>
			<column name="example" type="varchar(20)"/>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_return_periods"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: return_periods" author="Environment Agency">
		<createIndex indexName="idx_md_return_periods_name" tableName="md_return_periods" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_return_periods" indexName="idx_md_return_periods_name"/>
		</rollback>
	</changeSet>
	<!--
	****************************************************************
	Text Values
	****************************************************************
	-->

	<changeSet id="create-table: text_values" author="Environment Agency">
		<createTable tableName="md_text_values">
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(30)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="preferred" type="bigint">
				<constraints nullable="true" foreignKeyName="fk_text_values_preferred" references="md_text_values(id)"/>
			</column>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_text_values"/>
		</rollback>
	</changeSet>
	<changeSet id="create-index: text_values" author="Environment Agency">
		<createIndex indexName="idx_md_text_values_name" tableName="md_text_values" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_text_values" indexName="idx_md_text_values_name"/>
		</rollback>
	</changeSet>
	<!--
  ****************************************************************
  ParameterHierarchy
  ****************************************************************
  -->
	<changeSet id="create-table: md_parameter_hierarchy" author="Environment Agency">
		<createTable tableName="md_parameter_hierarchy">
			<column name="return_type" type="varchar(80)">
				<constraints nullable="false" unique="false"/>
			</column>
			<column name="parameter" type="varchar(150)">
				<constraints nullable="false" unique="false"/>
			</column>
			<column name="releases_and_transfers" type="varchar(50)">
				<constraints nullable="false" unique="false"/>
			</column>
			<column name="units" type="varchar(50)">
				<constraints nullable="false" unique="false"/>
			</column>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_parameter_hierarchy"/>
		</rollback>
	</changeSet>

	<changeSet id="load-data: md_parameter_hierarchy" author="Environment Agency">
		<preConditions onFail="HALT">
			<tableExists tableName="md_parameter_hierarchy"/>
			<sqlCheck expectedResult="0">select count(*) from md_parameter_hierarchy</sqlCheck>
		</preConditions>
		<loadData file="${parameterHierarchyFile}" tableName="md_parameter_hierarchy"/>
		<rollback>
			<delete tableName="md_parameter_hierarchy"/>
		</rollback>
	</changeSet>

	<changeSet id="create-index: md_parameter_hierarchy" author="Environment Agency">
		<createIndex indexName="idx_md_parameter_hierarchy" tableName="md_parameter_hierarchy" unique="true">
			<column name="return_type"/>
			<column name="parameter"/>
			<column name="releases_and_transfers"/>
			<column name="units"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_parameter_hierarchy" indexName="idx_md_parameter_hierarchy"/>
		</rollback>
	</changeSet>

	<!--
	****************************************************************
	Releases and Transfers
	****************************************************************
	-->
	<changeSet id="create-table: releases_and_transfers" author="Environment Agency">
		<createTable tableName="md_releases_and_transfers">
			<!-- Currently unique identifiers are generally 6 characters long but this could change! -->
			<column name="id" type="bigserial">
				<constraints primaryKey="true" nullable="false"/>
			</column>
			<column name="name" type="varchar(50)">
				<constraints nullable="false" unique="true"/>
			</column>
			<column name="create_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
			<column name="last_changed_date" type="timestamp without timezone" defaultValueComputed="current_timestamp">
				<constraints nullable="false"/>
			</column>
		</createTable>
		<rollback>
			<dropTable tableName="md_releases_and_transfers"/>
		</rollback>
	</changeSet>


	<changeSet id="create-index: releases_and_transfers" author="Environment Agency">
		<createIndex indexName="idx_md_releases_and_transfers_name" tableName="md_releases_and_transfers" unique="true">
			<column name="name"/>
		</createIndex>
		<rollback>
			<dropIndex tableName="md_releases_and_transfers" indexName="idx_md_releases_and_transfers_name"/>
		</rollback>
	</changeSet>
</databaseChangeLog>